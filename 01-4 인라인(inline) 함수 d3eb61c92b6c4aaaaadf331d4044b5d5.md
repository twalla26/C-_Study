# 01-4 인라인(inline) 함수

---

## 매크로 함수란?

C언어에서는 #define 선행처리 지시문에 인수로 함수의 정의를 전달함으로써, 함수처럼 동작하는 매크로를 만들 수 있다.

```cpp
#include <iostream>
#define SQUARE(x) ((x)*(x))

int main(void) {
	std::cout << SQUARE(5) << std::endl;
	return 0;
}
```

위의 코드는 전처리 과정을 거치면 다음과 같이 변경된다.

```cpp
#include <iostream>

int main(void) {
	std::cout << ((5)*(5)) << std::endl;
	return 0;
}
```

여기서 중요한 점은 함수의 몸체부분이 함수의 호출문을 대체했다는 점이다. 위와 같이 함수의 몸체부분이 함수호출 문장을 완전히 대체했을 때 ‘함수가 인라인화 되었다고 한다.’

### 매크로 함수 주의사항

1. 매크로 함수의 전체를 괄호(())로 감싸야 합니다.
2. 매크로 함수의 인수들도 각각 괄호로 감싸야 합니다.
3. 매크로 함수를 호출할 때에는 증감 연산자(++, --)나 복합 대입 연산자 등은 사용하지 않는 것이 좋습니다.

매크로 함수는 얼핏 함수처럼 보이지만 일반 함수와는 전혀 다른 시간대에 이루어지는 다른 과정임을 명심해야 합니다. 일반 함수는 컴파일러에 의해 처리되지만, 매크로 함수는 전처리기에 의해서 처리된다.

### 매크로 함수의 장단점

장점

1. 매크로 함수는 단순 치환만을 해주므로, 인수의 타입을 신경 쓰지 않습니다.
2. 매크로 함수를 사용하면 여러 개의 명령문을 동시에 포함할 수 있습니다.
3. 함수 호출에 의한 성능 저하가 일어나지 않으므로, 프로그램의 실행속도가 향상됩니다.

단점

1. 원하는 결과를 얻는 정확한 매크로 함수의 구현은 어려우며, 따라서 디버깅 또한 매우 어렵습니다.
2. 매크로 함수의 크기가 증가하면 증가할수록 사용되는 괄호 또한 매우 많아져서 가독성이 떨어집니다.

## C++ 기반의 인라인 함수 정의

인라인 함수는 매크로 함수의 일부 장점은 유지하되, 단점은 제거한 함수이다.

```cpp
#include <iostream>

inline int SQUARE(int x) { // 인라인 함수의 정의, 함수 SQUARE는 인라인 함수
    return x*x;
}

int main(void) {
    std::cout << SQUARE(5) << std::endl; // SQUARE 함수 호출
    std::cout << SQUARE(12) << std::endl; // 인라인 함수이므로 몸체 부분이 호출문을 대체
    return 0;
}
```

참고로 매크로를 이용한 함수의 인라인화는 전처리기에 의해 처리되지만, 키워드 inline을 이용한 함수의 인라인화는 컴파일러에 의해서 처리가 된다. 따라서 컴파일러는 함수의 인라인화가 오히려 성능에 해가 된다고 판단할 경우, 이 키워드를 무시해버리기도 한다. 또한, 컴파일러는 필요한 경우 일부 함수를 임의로 인라인 처리하기도 한다.

### 매크로 함수에는 있지만, 인라인 함수에는 없는 장점

다음 매크로 함수를 보면

```cpp
#define SQUARE(x) ((x)*(x))
```

이는 자료형에 의존적이지 않은 함수가 된다. 따라서 어떤 자료형을 넣어도 데이터의 손실이 발생하지 않는다.

하지만 다음과 같은 인라인 함수는 

```cpp
inline int SQUARE(int x) {return x*x;}
```

int형 기반으로 정의된 함수이기 때문에 x에 3.15을 대입했을 때 0.15가 손실되어서 9가 출력된다. 이 경우에는 템플릿을 이용해서 문제를 해결할 수 있으나 템플릿에 대해서는 다음에 다뤄보자.