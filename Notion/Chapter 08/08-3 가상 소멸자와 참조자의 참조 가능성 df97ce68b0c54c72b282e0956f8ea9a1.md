# 08-3 ê°€ìƒ ì†Œë©¸ìì™€ ì°¸ì¡°ìì˜ ì°¸ì¡° ê°€ëŠ¥ì„±

---

## ê°€ìƒ ì†Œë©¸ì(Virtual Destructor)

```cpp
#include <iostream>
using namespace std;

class First {
private:
    char * strOne;
public:
    First(char * str) { // ìƒì„±ì
        strOne = new char[strlen(str)+1]; // ë™ì  í• ë‹¹
    }
    ~First() { // ì†Œë©¸ì
        cout << "~First()" << endl;
        delete []strOne; // ë™ì  í• ë‹¹ëœ ë©”ëª¨ë¦¬ í•´ì œ
    }
};

class Second : public First {
private:
    char * strTwo;
public:
    Second(char * str1, char * str2) : First(str1) { // ìƒì„±ì
        strTwo = new char[strlen(str2)+1]; // ë™ì í• ë‹¹
    }
    ~Second() { // ì†Œë©¸ì
        cout << "~Second()" << endl;
        delete []strTwo; // ë™ì  í• ë‹¹ëœ ë©”ëª¨ë¦¬ í•´ì œ
    }
};

int main(void) {
    First * ptr = new Second("simple", "complex"); // ptrì€ Firstí˜• í¬ì¸í„° ë³€ìˆ˜ì´ê³ , Second í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ê°€ë¦¬í‚´
    delete ptr; // ë©”ëª¨ë¦¬ í•´ì œ
    return 0;
}
```

~First() // First í´ë˜ìŠ¤ì˜ ì†Œë©¸ìë§Œ í˜¸ì¶œë˜ì—ˆë‹¤. â†’ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ

â†’ ê°ì²´ì˜ ì†Œë©¸ê³¼ì •ì—ì„œëŠ” delete ì—°ì‚°ìì— ì‚¬ìš©ëœ í¬ì¸í„° ë³€ìˆ˜ì˜ ìë£Œí˜•ì— ìƒê´€ì—†ì´ ëª¨ë“  ì†Œë©¸ìê°€ í˜¸ì¶œë˜ì–´ì•¼ í•œë‹¤. â†’ ì†Œë©¸ìì— virtual ì„ ì–¸ ì¶”ê°€

```cpp
#include <iostream>
using namespace std;

class First {
private:
    char * strOne;
public:
    First(char * str) { // ìƒì„±ì
        strOne = new char[strlen(str)+1]; // ë™ì  í• ë‹¹
    }
    virtual ~First() { // ì†Œë©¸ì
        cout << "~First()" << endl;
        delete []strOne; // ë™ì  í• ë‹¹ëœ ë©”ëª¨ë¦¬ í•´ì œ
    }
};

class Second : public First {
private:
    char * strTwo;
public:
    Second(char * str1, char * str2) : First(str1) { // ìƒì„±ì
        strTwo = new char[strlen(str2)+1]; // ë™ì í• ë‹¹
    }
    virtual ~Second() { // ì†Œë©¸ì
        cout << "~Second()" << endl;
        delete []strTwo; // ë™ì  í• ë‹¹ëœ ë©”ëª¨ë¦¬ í•´ì œ
    }
};

class Third : public Second {
private:
    char * strThree;
public:
    Third(char * str1, char * str2, char * str3) : Second(str1, str2) {
        strThree = new char[strlen(str3)+1];
    }
    virtual ~Third() {
        cout << "~Third()" << endl;
        delete []strThree;
    }
};

int main(void) {
    First * ptr = new Third("simple", "complex", "soso"); // ptrì€ Firstí˜• í¬ì¸í„° ë³€ìˆ˜ì´ê³ , Third í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ê°€ë¦¬í‚´
    delete ptr; // ë©”ëª¨ë¦¬ í•´ì œ
    return 0;
}
```

~Third()
~Second()
~First()

ë‹¤ìŒ ê²°ê³¼ê°€ ë‚˜ì˜¨ ê³¼ì •ì„ ì‚´í´ë³´ì.

delete ptr;

1. virtual ~First() {}; // ê°ì²´ì˜ ì†Œë©¸ê³¼ì •ì—ì„œ í˜¸ì¶œë¨
2. virtual ~Third() {}; // virtual ì†Œë©¸ìë¡œ ëŒ€ì‹  í˜¸ì¶œë¨
3. virtual ~Second() {}; // ~Third() ì‹¤í–‰ í›„ì— ì´ì–´ì„œ ì‹¤í–‰
4. virtual ~First() {}; // ~Second() ì‹¤í–‰ í›„ì— ì´ì–´ì„œ ì‹¤í–‰

<aside>
ğŸ“Œ ê°€ìƒ ì†Œë©¸ìê°€ í˜¸ì¶œë˜ë©´, ìƒì†ì˜ ê³„ì¸µ êµ¬ì¡°ìƒ ë§¨ ì•„ë˜ì— ì¡´ì¬í•˜ëŠ” ìœ ë„ í´ë˜ìŠ¤ì˜ ì†Œë©¸ìê°€ ëŒ€ì‹  í˜¸ì¶œë˜ë©´ì„œ, ê¸°ì´ˆ í´ë˜ìŠ¤ì˜ ì†Œë©¸ìê°€ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œëœë‹¤.

</aside>

## ì°¸ì¡°ìì˜ ì°¸ì¡° ê°€ëŠ¥ì„±

<aside>
ğŸ“Œ C++ì—ì„œ, AAAí˜• ì°¸ì¡°ìëŠ” AAA ê°ì²´ ë˜ëŠ” AAAë¥¼ ì§ì ‘ í˜¹ì€ ê°„ì ‘ì ìœ¼ë¡œ ìƒì†í•˜ëŠ” ëª¨ë“  ê°ì²´ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.

</aside>

<aside>
ğŸ“Œ Firstí˜• ì°¸ì¡°ìë¥¼ ì´ìš©í•˜ë©´ First í´ë˜ìŠ¤ì— ì •ì˜ëœ MyFunc í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ê³ , Secondí˜• ì°¸ì¡°ìë¥¼ ì´ìš©í•˜ë©´ Second í´ë˜ìŠ¤ì— ì •ì˜ëœ MyFunc í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ê³ , Thirdí˜• ì°¸ì¡°ìë¥¼ ì´ìš©í•˜ë©´ Third í´ë˜ìŠ¤ì— ì •ì˜ëœ MyFunc í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ëŠ”êµ¬ë‚˜!

</aside>

<aside>
ğŸ“Œ ê°€ìƒí•¨ìˆ˜ì˜ ê°œë…ë„ í¬ì¸í„°ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì°¸ì¡°ìì—ë„ ê·¸ëŒ€ë¡œ ì ìš©ëœë‹¤.

</aside>

```cpp
#include <iostream>
using namespace std;

class First {
public:
    void FirstFunc() { cout << "FirstFunc()" << endl; }
    virtual void SimpleFunc() { cout << "First's SimpleFunc()" << endl; } // virtual ì„ ì–¸
};

class Second : public First {
public:
    void SecondFunc() { cout << "SecondFunc()" << endl; }
    virtual void SimpleFunc() { cout << "Second's SimpleFunc()" << endl; } // virtual ì„ ì–¸
};

class Third: public Second {
public:
    void ThirdFunc() { cout << "ThirdFunc()" << endl; }
    virtual void SimpleFunc() { cout << "Third's SimpleFunc()" << endl; } // virtual ì„ ì–¸
};

int main(void) {
    Third obj; // Thirdí˜• ê°ì²´ obj ìƒì„±
    obj.FirstFunc(); // Third í´ë˜ìŠ¤ê°€ Second, First í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ìœ¼ë‹ˆ, ê°ê°ì˜ ë©¤ë²„ë³€ìˆ˜ í˜¸ì¶œ ê°€ëŠ¥
    obj.SecondFunc();
    obj.ThirdFunc();
    obj.SimpleFunc(); // objëŠ” Third í´ë˜ìŠ¤ì˜ ê°ì²´ì´ë¯€ë¡œ ê°€ì¥ ë§ˆì§€ë§‰ì— ì˜¤ë²„ë¼ì´ë”© ëœ Third í´ë˜ìŠ¤ì˜ SimpleFuncë¥¼ í˜¸ì¶œ

    Second & sref = obj; // objëŠ” Second í´ë˜ìŠ¤ë¥¼ ì§ì ‘ì°¸ì¡°í•˜ëŠ” Thirdí˜• ê°ì²´ì´ë¯€ë¡œ, Secondí˜• ì°¸ì¡°ìë¡œ ì°¸ì¡° ê°€ëŠ¥
    sref.FirstFunc(); // ì»´íŒŒì¼ëŸ¬ëŠ” ì°¸ì¡°ìì˜ ìë£Œí˜•ì„ ê°€ì§€ê³  í•¨ìˆ˜ì˜ í˜¸ì¶œê°€ëŠ¥ì„±ì„ íŒë‹¨í•˜ê¸° ë•Œë¬¸ì—
    sref.SecondFunc(); // srefëŠ” Thirdí˜• ê°ì²´ objë¥¼ ì°¸ì¡°í•˜ì§€ë§Œ, ThirdFunc() í•¨ìˆ˜ëŠ” í˜¸ì¶œ ë¶ˆê°€ëŠ¥
    sref.SimpleFunc();
    // SimpleFunc í•¨ìˆ˜ëŠ” ê°€ìƒí•¨ìˆ˜ì´ë¯€ë¡œ, srefê°€ ì‹¤ì œë¡œ ì°¸ì¡°í•˜ëŠ” ê°ì²´(Thirdí˜• ê°ì²´)ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•¨ìˆ˜ í˜¸ì¶œ
    // -> ê°€ì¥ ë§ˆì§€ë§‰ì— ì˜¤ë²„ë¼ì´ë”©ëœ Thirdí´ë˜ìŠ¤ì— ì •ì˜ëœ í•¨ìˆ˜ê°€ í˜¸ì¶œë¨.

    First & fref = obj; // objëŠ” First í´ë˜ìŠ¤ë¥¼ ê°„ì ‘ì°¸ì¡°í•˜ëŠ” Thirdí˜• ê°ì²´ì´ë¯€ë¡œ, Firstí˜• ì°¸ì¡°ìë¡œ ì°¸ì¡° ê°€ëŠ¥
    fref.FirstFunc(); // Firstí˜• ì°¸ì¡°ìì´ë¯€ë¡œ, FirstFunc() í•¨ìˆ˜ë§Œ í˜¸ì¶œ ê°€ëŠ¥
    fref.SimpleFunc();
    // SimpleFunc í•¨ìˆ˜ëŠ” ê°€ìƒí•¨ìˆ˜ì´ë¯€ë¡œ, frefê°€ ì‹¤ì œë¡œ ì°¸ì¡°í•˜ëŠ” ê°ì²´(Thirdí˜• ê°ì²´)ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•¨ìˆ˜ í˜¸ì¶œ
    // -> ê°€ì¥ ë§ˆì§€ë§‰ì— ì˜¤ë²„ë¼ì´ë”©ëœ Thirdí´ë˜ìŠ¤ì— ì •ì˜ëœ í•¨ìˆ˜ê°€ í˜¸ì¶œë¨.
    return 0;
}
```

FirstFunc()
SecondFunc()
ThirdFunc()
Third's SimpleFunc()
FirstFunc()
SecondFunc()
Third's SimpleFunc()
FirstFunc()
Third's SimpleFunc()